name: Financial Reporting Service

on:
  push: 
  workflow_dispatch:

jobs:
  build:
    runs-on: ebpf-runners-cicd
    steps:
      - uses: actions/checkout@v3
      
      - name: Secured Build
        run: |
          echo "Secure financial reporting service build on this runner"
          hostname
          env
          ls -la

      - name: kntrl agent
        run: sudo docker run --privileged \
          --pid=host \
          --network=host \
          --cgroupns=host \
          --volume=/sys/kernel/debug:/sys/kernel/debug:ro \
          --volume /tmp:/tmp \
          --rm docker.io/kondukto/kntrl:0.1.2 \
          --mode=monitor 
  
  malicoius-build:
    runs-on: ebpf-runners-cicd
    steps:
      - uses: actions/checkout@v3
      
      - name: Malicious Build
        run: |
          echo "Simulate malicious build trying to gain access to financial reporting service build on this runner and see how eBPF helps prevent and block that"
          hostname
          env
          ls -la